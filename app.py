import os
import openai

from flask import Flask
from flask import request, render_template

app = Flask(__name__, static_url_path="/templates")

@app.route('/')
def hello_world():
    return render_template("index.html")

@app.route("/completion", methods=["POST"])
def caption():
     return getCompletion(request.json["prompt"])

def getCompletion(blackCard = ""):

	openai.api_key = os.environ["OPENAI_API_KEY"]

	start_sequence = " ->"
	restart_sequence = "\n\"\"\"\n\n\"\"\""

	response = openai.Completion.create(
	  engine="davinci",
	  prompt="You are required to find the common category for the groups given and then give some more examples.\n\n\"\"\"\nTom Holland, Andrew Garfield, Tobey Maguire -> Actors who played Spider-Man -> ***\n\"\"\"\n\n\"\"\"\nAlbert Einstein, Marie Curie, Bob Dylan -> Nobel Prize winners -> Paulo Coelho, Marie Curie, Barack Obama\n\"\"\"\n\n\"\"\"\nPierce Brosnan, Daniel Craig, Sean Connery, Timothy Dalton -> Actors who played James Bond -> Roger Moore\n\"\"\"\n\n\"\"\"\nChristian Bale, George Clooney, Michael Keaton -> Actors who played Batman -> Val Kilmer\n\"\"\"\n\n\"\"\"\nIn the Mood for Love, Chungking Express, Happy Together -> Movies of Wong Kar-Wai -> 2046, Days of Being Wild\n\"\"\"\n\n\"\"\"\nBlackbird, Michelle, Nowhere Man -> Songs of the Beatles -> Norwegian Wood, Let It Be, Sgt. Pepper's Lonely Hearts Club Band, Lucy in the Sky with Diamonds\n\"\"\"\n\n\"\"\"\nForce Awakens, Phantom Menace, The Empire Strikes Back -> Movies of the Star Wars franchise -> Attack of the Clones, A New Hope, Return of the Jedi, Revenge of the Sith\n\"\"\"\n\n\"\"\"\nBelle, Elsa, Pocahontas -> Disney Princesses -> Rapunzel, Cinderella, Snow White\n\"\"\"\n\n\"\"\"\nEdward, Bella, Jacob -> Characters from Twilight -> ***\n\"\"\"\n\n\"\"\"\nDavid Tennant, Matt Smith, Peter Capaldi -> Doctors of Doctor Who -> Christopher Eccleston, Tom Baker, Paul McGann, Jodie Whittaker\n\"\"\"\n\n\"\"\"\nBefore Sunrise, Dazed and Confused, Boyhood -> Richard Linklater films -> Before Sunset, Before Midnight\n\"\"\"\n\n\"\"\"\nMr. Tambourine Man, My Back Pages, Changing of the Guards -> Songs of Bob Dylan -> Visions of Johanna, Like a Rolling Stone, Buckets of Rain\n\"\"\"\n\n\"\"\"\nMerlin, Gandalf, Dumbledore -> Fictional wizards -> Glinda the Good Witch, Harry Dresden\n\"\"\"\n\n\"\"\"\nEmma Watson, Daniel Craig, Robert Pattinson -> British actors -> Tom Holland, David Tennant, Judi Dench\n\"\"\"\n\n\"\"\"\nEmma Stone, Ryan Gosling -> Actors from La La Land -> ***\n\"\"\"\n\n\"\"\"\nLa La Land, Moonlight, Blade Runner 2049 -> Movies of 2017 -> Wonder Woman, Dunkirk\n\"\"\"\n\n\"\"\"\nLa La Land, The Notebook, Blade Runner 2049 -> Movies of Ryan Gosling -> Drive, Ides of March, The Nice Guys\n\"\"\"\n\n\"\"\"\nEasy A, Crazy Stupid Love, Amazing Spider-Man -> Movies of Emma Stone -> Zombieland, The Favourite\n\"\"\"\n\n\"\"\"\nLa La Land, Crazy Stupid Love, Gangster Squad -> Movies of Emma Stone and Ryan Gosling -> ***\n\"\"\"\n\n\"\"\"\nBillie Eilish, Alicia Keys, Taylor Swift -> Pop singers -> Katy Perry, Lady Gaga, Beyonce\n\"\"\"\n\n\"\"\"\nWoody Guthrie, Bob Dylan -> Folk musicians -> Joan Baez, Leonard Cohen\n\"\"\"\n\n\"\"\"\nViolin, Piano, Saxophone -> Musical instruments -> Guitar, Clarinet, Banjo\n\"\"\"\n\n\"\"\"\n22, Red, Style -> Albums of Taylor Swift -> Fearless, Reputation\n\"\"\"\n\n\"\"\"\nCrime and Punishment, The Gambler, Anna Karenina -> Russian novels -> The Idiot, Brother Karamazov\n\"\"\"\n\n\"\"\"\nBoy with the Arab Strap, Sukie in the Graveyard -> Songs of Belle and Sebastian -> There is an Everlasting Song, If She Wants Me, Like Dylan in the Movies, Me and the Major, Funny Little Frog\n\"\"\"\n\n\"\"\" \nJohn, Paul, Ringo, George -> Members of The Beatles -> ***\n\"\"\"\n\n\"\"\"\nHarvard, Yale, Brown -> Ivy League colleges -> Stanford, Princeton, Columbia\n\"\"\"\n\n\"\"\"\nYahoo, Bing -> Search engines -> Google, DuckDuckGo\n\"\"\"\n\n\"\"\"\nGandalf, Frodo, Sam -> Characters in The Lord of the Rings -> Galadriel, Rowan, Elrond\n\"\"\"\n\n\"\"\"\nIron Man, Captain America -> Heroes of the Marvel Cinematic Universe -> Ant-Man, Black Panther, Spider-Man\n\"\"\"\n\n\"\"\"\nRandy Jackson, Bebe Ruth Jackson, Janet Jackson -> Family members of Janet Jackson -> La Toya Jackson\n\"\"\"\n\n\"\"\"\nBad, Thriller, Dangerous -> Michael Jackson albums -> Off the Wall, Bad, Invincible\n\"\"\"\n\n\"\"\"\nDevil Wears Prada, Iron Lady, Sophie's Choice -> Movies of Meryl Streep -> Julie & Julia, The Post\n\"\"\"\n\n\"\"\"\nKiwi, Sign of the Times, Sweet Creature -> Harry Styles songs -> ***\n\"\"\"\n\n\"\"\"\nDa Vinci Code, Angels and Demons -> Dan Brown books -> The Lost Symbol, Inferno\n\"\"\"\n\n\"\"\"\nForrest Gump, Philadelphia -> Movies of Tom Hanks -> Cast Away, Saving Private Ryan\n\"\"\"\n\n\"\"\"\nTina Fey, Amy Poehler, Kenan Thomson, Jimmy Fallon -> Saturday Night Live cast members -> Seth Meyers\n\"\"\"\n\n\"\"\"\nApple, Banana -> Fruit -> Orange, Pear\n\"\"\"\n\n\"\"\"\nGame of Thrones, House of Lies -> TV shows -> Breaking Bad, Mad Men\n\"\"\"\n\n\"\"\"\nUnbreakable Kimmy Schmidt, 30 Rock -> TV shows of Tina Fey -> ***\n\"\"\"\n\n\"\"\"\nThe Office, Parks and Recreation, Brooklyn Nine-Nine -> TV shows of Mike Schur -> ***\n\"\"\"\n\n\"\"\"\nMichael, Dwight, Jim, Pam, Ryan, Stanley -> Characters from The Office -> ***\n\"\"\"\n\n\"\"\"\nCam, Mitchell, Lily, Claire, Phil -> Characters from Modern Family -> ***\n\"\"\"\n\n\"\"\"\nGin, Vodka, Whiskey -> Alcoholic drinks -> Rum, Scotch, Beer\n\"\"\"\n\n\"\"\"\nCake, Present, Candle -> Birthday Gifts -> Watch, Bracelet, Necklace\n\"\"\"\n\n\"\"\"\nLove of My Life, I Want to Break Free -> Queen songs -> Killer Queen\n\"\"\"\n\n\"\"\"\nAnakin, Obi-Wan, Rey -> Characters from Star Wars -> Yoda, Han Solo, Darth Vader\n\"\"\"\n\n\"\"\"\nIron Man, Doctor Strange, Spider-Man -> Marvel Cinematic Universe characters -> Ant-Man, Black Panther, Star Lord\n\"\"\"\n\n\"\"\"\nRobert Downey Jr., Benedict Cumberbatch -> Actors of Marvel Cinematic Universe -> Chris Evans, Chris Hemsworth, Chris Pratt\n\"\"\"\n\n\"\"\"\nHenry Cavill, Ben Affleck, Ezra Miller -> DC Extended Universe actors -> Gal Gadot, Ray Fisher\n\"\"\"\n\n\"\"\"\nBatman, Superman, Flash -> DC Comic Characters -> Aquaman, Wonder Woman, Green Lantern\n\"\"\"\n\n\"\"\"\nGal Gadot, Lynda Cartwell -> Actresses from Wonder Woman -> ***\n\"\"\"\n\n\"\"\"\nPeter, Gamorra, Groot, Rocket -> Guardians of the Galaxy -> Drax, Mantis\n\"\"\"\n\n\"\"\"\nSheldon, Leonard, Penny, Howard, Raj -> Characters from The Big Bang Theory -> Bernadette, Amy, Stuart\n\"\"\"\n\n\"\"\"\nBarney, Ted, Lily, Marshall, Robin -> Characters from How I Met Your Mother -> ***\n\"\"\"\n\n\"\"\"\nRose, Martha, Donna, Amy, Clara -> Companions of Doctor Who -> Bill, Sarah Jane\n\"\"\"\n\n\"\"\"\nHBO, AMC, CBS -> Cable/network television channels -> Starz, TBS, ABC, PBS\n\"\"\"\n\n\"\"\"\n1Q84, Norwegian Wood, Kafka on the Shore -> Novels of Haruki Murakami -> The Wind-up Bird Chronicle, A Wild-Sheep Chase, Killing Commandatore\n\"\"\"\n\n\"\"\"\nAM, Whatever People Say I Am That's What I'm Not, Humbug -> Albums of Arctic Monkeys -> ***\n\"\"\"\n\n\"\"\"\nFather and Son, Wild World -> Songs of Cat Stevens -> Lady D'arbanville\n\"\"\"\n\n\"\"\"\nMeryl Streep, Jennifer Lawrence, Emma Stone -> Oscar Winners -> Leonardo DiCaprio, Quentin Tarantino, Daniel Day-Lewis\n\"\"\"\n\n\"\"\"\nEthan Hawke, Julie Delpy, Richard Linklater -> Writers and directors of Before Sunrise -> ***\n\"\"\"\n\n\"\"\"\nHarvard, Yale, Brown -> Ivy League universities -> Stanford, Princeton, Columbia\n\"\"\"\n\n\"\"\"\nHomer, Marge -> Simpsons characters -> Bart, Lisa\n\"\"\"\n\n\"\"\"\nViva la Vida, Fix You, Paradise -> Coldplay songs -> Clocks, In My Place, Yellow\n\"\"\"\n\n\"\"\"\nTaxi Driver, Wolf of Wall Street -> Movies directed by Martin Scorsese -> Raging Bull, Casino\n\"\"\"\n\n\"\"\"\n" + blackCard,
	  temperature=1,
	  max_tokens=64,
	  top_p=1,
	  stop=["\n\"\"\""]
	)
	
	print(blackCard)
	print(response["choices"][0].text)

	return response["choices"][0].text
